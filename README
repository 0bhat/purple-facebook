Purple Facebook implements the Facebook Messenger protocol into pidgin,
finch, and libpurple. While the primary implementation is for purple3,
this plugin is back-ported for purple2.

## Building and Installing

Make sure glib, json-glib, libpurple (pidgin), and zlib are installed
with their headers and development information. If these packages came
from the distribution's repository, they will likely need additional
development packages, usually suffixed with -dev.

    $ git clone https://github.com/jgeboski/purple-facebook.git
    $ cd purple-facebook
    $ ./autogen.sh
    $ make

With a "global" (or system) installation:

    $ make install

Or with a "local" installation:

    $ mkdir -p ~/.purple/plugins
    $ cp pidgin/libpurple/protocols/facebook/.libs/libfacebook.so ~/.purple/plugins

## Building and Installing on Windows

These instructions are simply a continuation of the ones provided by
pidgin. Start by setting up a built pidgin source tree in
`$PIDGIN_DEV_ROOT/win32-dev/pidgin-2.10.11`.

See: https://developer.pidgin.im/wiki/BuildingWinPidgin

### Building on Windows

Download and extract glib:
- Download: [glib-dev_2.28.8-1_win32.zip](http://ftp.gnome.org/pub/gnome/binaries/win32/glib/2.28/glib-dev_2.28.8-1_win32.zip)
- Download: [gettext-runtime-dev_0.18.1.1-2_win32.zip](http://ftp.gnome.org/pub/gnome/binaries/win32/dependencies/gettext-runtime-dev_0.18.1.1-2_win32.zip)
- Download: [zlib-dev_1.2.5-2_win32.zip](http://ftp.gnome.org/pub/gnome/binaries/win32/dependencies/zlib-dev_1.2.5-2_win32.zip)
- Extract all zips to `$PIDGIN_DEV_ROOT/win32-dev/glib-2.28.8`

Download and extract json-glib:
- Download: [json-glib-0.14.tar.gz](https://github.com/jgeboski/purple-facebook/releases/download/downloads/json-glib-0.14.tar.gz)
- Extract to `$PIDGIN_DEV_ROOT/win32-dev/json-glib-0.14`

Compile the plugin:

    $ cd $PIDGIN_DEV_ROOT/purple-facebook #-<version>
    $ ./update  # not required for dist tarballs
    $ make -f Makefile.mingw install
    $ cp win32-install-dir/plugins/libfacebook.dll C:/Program Files/Pidgin/plugins  # alternatively: Program Files (x86)

### Installing on Windows

1. Download: [libjson-glib-1.0.dll](https://github.com/jgeboski/purple-facebook/releases/download/downloads/libjson-glib-1.0.dll)
2. Copy the downloaded `libjson-glib-1.0.dll` to `C:\Program Files\Pidgin`
3. Download the latest `libfacebook.dll` from the [releases](https://github.com/jgeboski/purple-facebook/releases)
4. Copy the downloaded `libfacebook.dll` to `C:\Program Files\Pidgin\plugins`

Note: `Program Files` will be `Program Files (x86)` on 64-bit Windows.

## Debugging

Before debugging can begin, the plugin must be compiled with debugging
support. Once debugging support has been enabled, one of the two
supported environment variables can be defined to enable debugging
output. This can be used in unison with debuggers such as GDB, which
should enable easier tracing of bugs.

When posting to the issue tracker, please ensure any sensitive
information has been stripped.

Enable debugging support (enabled by default with Windows):

    $ ./autogen.sh --enable-debug

Enable debugging output:

    $ export PURPLE_UNSAFE_DEBUG=1 PURPLE_VERBOSE_DEBUG=1
    $ pidgin --debug
    OR
    $ PURPLE_UNSAFE_DEBUG=1 PURPLE_VERBOSE_DEBUG=1 pidgin --debug

Obtaining a GDB backtrace:

    $ PURPLE_UNSAFE_DEBUG=1 PURPLE_VERBOSE_DEBUG=1 gdb \
        -ex 'handle SIGPIPE nostop noprint pass' \
        -ex "set breakpoint pending on" \
        -ex "set pagination off" \
        -ex run -ex bt \
        --args pidgin --debug
